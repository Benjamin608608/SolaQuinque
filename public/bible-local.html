<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聖經 - 本地版本</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #f1f5f9;
            --accent: #dc2626;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
            color: var(--text-primary);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .version-selector {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
            gap: 10px;
            align-items: center;
        }
        
        .version-selector select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 14px;
        }
        
        .testament-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .testament-tab {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: var(--secondary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .testament-tab.active {
            background: var(--primary);
            color: white;
        }
        
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .book-button {
            padding: 10px;
            border: none;
            border-radius: 6px;
            background: var(--secondary);
            color: var(--text-primary);
            cursor: pointer;
            text-align: left;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .book-button:hover {
            background: var(--primary);
            color: white;
        }
        
        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 5px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .chapter-button {
            padding: 8px;
            border: none;
            border-radius: 4px;
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .chapter-button:hover {
            background: var(--primary);
            color: white;
        }
        
        .chapter-button.active {
            background: var(--primary);
            color: white;
        }
        
        .bible-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        .bible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .bible-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .bible-version {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .bible-text {
            line-height: 1.8;
            font-size: 16px;
        }
        
        .verse {
            margin-bottom: 8px;
            padding: 4px 0;
        }
        
        .verse-number {
            color: var(--primary);
            font-weight: bold;
            margin-right: 8px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: var(--accent);
        }
        
        /* 隱藏的解釋功能按鈕 */
        .explain-button {
            display: none;
        }
        
        /* 響應式設計 */
        @media (max-width: 768px) {
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .chapters-grid {
                grid-template-columns: repeat(auto-fill, minmax(35px, 1fr));
            }
            
            .bible-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>聖經</h1>
        </div>
        
        <div class="version-selector">
            <label>版本：</label>
            <select id="bibleVersion">
                <option value="CUV">和合本(CUV)</option>
                <option value="KJV">KJV</option>
            </select>
        </div>
        
        <div class="testament-tabs">
            <button class="testament-tab active" id="tabOT">舊約</button>
            <button class="testament-tab" id="tabNT">新約</button>
        </div>
        
        <div id="booksGrid" class="books-grid"></div>
        <div id="chaptersGrid" class="chapters-grid" style="display: none;"></div>
        <div id="bibleContent" class="bible-content" style="display: none;"></div>
    </div>

    <script>
        // 聖經書卷資料
        const booksOT = [
            { zh: '創世記', en: 'Genesis', engs: 'Gen', id: 1, chapters: 50 },
            { zh: '出埃及記', en: 'Exodus', engs: 'Exo', id: 2, chapters: 40 },
            { zh: '利未記', en: 'Leviticus', engs: 'Lev', id: 3, chapters: 27 },
            { zh: '民數記', en: 'Numbers', engs: 'Num', id: 4, chapters: 36 },
            { zh: '申命記', en: 'Deuteronomy', engs: 'Deu', id: 5, chapters: 34 },
            { zh: '約書亞記', en: 'Joshua', engs: 'Jos', id: 6, chapters: 24 },
            { zh: '士師記', en: 'Judges', engs: 'Jdg', id: 7, chapters: 21 },
            { zh: '路得記', en: 'Ruth', engs: 'Rth', id: 8, chapters: 4 },
            { zh: '撒母耳記上', en: '1 Samuel', engs: '1Sa', id: 9, chapters: 31 },
            { zh: '撒母耳記下', en: '2 Samuel', engs: '2Sa', id: 10, chapters: 24 },
            { zh: '列王紀上', en: '1 Kings', engs: '1Ki', id: 11, chapters: 22 },
            { zh: '列王紀下', en: '2 Kings', engs: '2Ki', id: 12, chapters: 25 },
            { zh: '歷代志上', en: '1 Chronicles', engs: '1Ch', id: 13, chapters: 29 },
            { zh: '歷代志下', en: '2 Chronicles', engs: '2Ch', id: 14, chapters: 36 },
            { zh: '以斯拉記', en: 'Ezra', engs: 'Ezr', id: 15, chapters: 10 },
            { zh: '尼希米記', en: 'Nehemiah', engs: 'Neh', id: 16, chapters: 13 },
            { zh: '以斯帖記', en: 'Esther', engs: 'Est', id: 17, chapters: 10 },
            { zh: '約伯記', en: 'Job', engs: 'Job', id: 18, chapters: 42 },
            { zh: '詩篇', en: 'Psalms', engs: 'Psa', id: 19, chapters: 150 },
            { zh: '箴言', en: 'Proverbs', engs: 'Pro', id: 20, chapters: 31 },
            { zh: '傳道書', en: 'Ecclesiastes', engs: 'Ecc', id: 21, chapters: 12 },
            { zh: '雅歌', en: 'Song of Solomon', engs: 'Son', id: 22, chapters: 8 },
            { zh: '以賽亞書', en: 'Isaiah', engs: 'Isa', id: 23, chapters: 66 },
            { zh: '耶利米書', en: 'Jeremiah', engs: 'Jer', id: 24, chapters: 52 },
            { zh: '耶利米哀歌', en: 'Lamentations', engs: 'Lam', id: 25, chapters: 5 },
            { zh: '以西結書', en: 'Ezekiel', engs: 'Eze', id: 26, chapters: 48 },
            { zh: '但以理書', en: 'Daniel', engs: 'Dan', id: 27, chapters: 12 },
            { zh: '何西阿書', en: 'Hosea', engs: 'Hos', id: 28, chapters: 14 },
            { zh: '約珥書', en: 'Joel', engs: 'Joe', id: 29, chapters: 3 },
            { zh: '阿摩司書', en: 'Amos', engs: 'Amo', id: 30, chapters: 9 },
            { zh: '俄巴底亞書', en: 'Obadiah', engs: 'Oba', id: 31, chapters: 1 },
            { zh: '約拿書', en: 'Jonah', engs: 'Jon', id: 32, chapters: 4 },
            { zh: '彌迦書', en: 'Micah', engs: 'Mic', id: 33, chapters: 7 },
            { zh: '那鴻書', en: 'Nahum', engs: 'Nah', id: 34, chapters: 3 },
            { zh: '哈巴谷書', en: 'Habakkuk', engs: 'Hab', id: 35, chapters: 3 },
            { zh: '西番雅書', en: 'Zephaniah', engs: 'Zep', id: 36, chapters: 3 },
            { zh: '哈該書', en: 'Haggai', engs: 'Hag', id: 37, chapters: 2 },
            { zh: '撒迦利亞書', en: 'Zechariah', engs: 'Zec', id: 38, chapters: 14 },
            { zh: '瑪拉基書', en: 'Malachi', engs: 'Mal', id: 39, chapters: 4 }
        ];
        
        const booksNT = [
            { zh: '馬太福音', en: 'Matthew', engs: 'Mat', id: 40, chapters: 28 },
            { zh: '馬可福音', en: 'Mark', engs: 'Mar', id: 41, chapters: 16 },
            { zh: '路加福音', en: 'Luke', engs: 'Luk', id: 42, chapters: 24 },
            { zh: '約翰福音', en: 'John', engs: 'Joh', id: 43, chapters: 21 },
            { zh: '使徒行傳', en: 'Acts', engs: 'Act', id: 44, chapters: 28 },
            { zh: '羅馬書', en: 'Romans', engs: 'Rom', id: 45, chapters: 16 },
            { zh: '哥林多前書', en: '1 Corinthians', engs: '1Co', id: 46, chapters: 16 },
            { zh: '哥林多後書', en: '2 Corinthians', engs: '2Co', id: 47, chapters: 13 },
            { zh: '加拉太書', en: 'Galatians', engs: 'Gal', id: 48, chapters: 6 },
            { zh: '以弗所書', en: 'Ephesians', engs: 'Eph', id: 49, chapters: 6 },
            { zh: '腓立比書', en: 'Philippians', engs: 'Php', id: 50, chapters: 4 },
            { zh: '歌羅西書', en: 'Colossians', engs: 'Col', id: 51, chapters: 4 },
            { zh: '帖撒羅尼迦前書', en: '1 Thessalonians', engs: '1Th', id: 52, chapters: 5 },
            { zh: '帖撒羅尼迦後書', en: '2 Thessalonians', engs: '2Th', id: 53, chapters: 3 },
            { zh: '提摩太前書', en: '1 Timothy', engs: '1Ti', id: 54, chapters: 6 },
            { zh: '提摩太後書', en: '2 Timothy', engs: '2Ti', id: 55, chapters: 4 },
            { zh: '提多書', en: 'Titus', engs: 'Tit', id: 56, chapters: 3 },
            { zh: '腓利門書', en: 'Philemon', engs: 'Phm', id: 57, chapters: 1 },
            { zh: '希伯來書', en: 'Hebrews', engs: 'Heb', id: 58, chapters: 13 },
            { zh: '雅各書', en: 'James', engs: 'Jas', id: 59, chapters: 5 },
            { zh: '彼得前書', en: '1 Peter', engs: '1Pe', id: 60, chapters: 5 },
            { zh: '彼得後書', en: '2 Peter', engs: '2Pe', id: 61, chapters: 3 },
            { zh: '約翰一書', en: '1 John', engs: '1Jo', id: 62, chapters: 5 },
            { zh: '約翰二書', en: '2 John', engs: '2Jo', id: 63, chapters: 1 },
            { zh: '約翰三書', en: '3 John', engs: '3Jo', id: 64, chapters: 1 },
            { zh: '猶大書', en: 'Jude', engs: 'Jud', id: 65, chapters: 1 },
            { zh: '啟示錄', en: 'Revelation', engs: 'Rev', id: 66, chapters: 22 }
        ];

        // 全局變數
        let currentBook = null;
        let currentChapter = null;
        let bibleData = null;

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            renderBooks(booksOT);
            setupEventListeners();
        });

        // 設置事件監聽器
        function setupEventListeners() {
            // 舊約/新約切換
            document.getElementById('tabOT').addEventListener('click', function() {
                setActiveTab('tabOT');
                renderBooks(booksOT);
            });
            
            document.getElementById('tabNT').addEventListener('click', function() {
                setActiveTab('tabNT');
                renderBooks(booksNT);
            });

            // 版本切換
            document.getElementById('bibleVersion').addEventListener('change', function() {
                if (currentBook && currentChapter) {
                    loadChapter(currentBook, currentChapter);
                }
            });
        }

        // 設置活動標籤
        function setActiveTab(activeTabId) {
            document.querySelectorAll('.testament-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(activeTabId).classList.add('active');
        }

        // 渲染書卷列表
        function renderBooks(books) {
            const booksGrid = document.getElementById('booksGrid');
            booksGrid.innerHTML = books.map(book => 
                `<button class="book-button" data-book='${JSON.stringify(book)}'>${book.zh}</button>`
            ).join('');

            // 添加點擊事件
            booksGrid.querySelectorAll('.book-button').forEach(button => {
                button.addEventListener('click', function() {
                    const book = JSON.parse(this.dataset.book);
                    selectBook(book);
                });
            });
        }

        // 選擇書卷
        function selectBook(book) {
            currentBook = book;
            currentChapter = null;
            
            // 顯示章節選擇
            renderChapters(book.chapters);
            document.getElementById('chaptersGrid').style.display = 'grid';
            document.getElementById('bibleContent').style.display = 'none';
        }

        // 渲染章節選擇
        function renderChapters(chapterCount) {
            const chaptersGrid = document.getElementById('chaptersGrid');
            chaptersGrid.innerHTML = '';
            
            for (let i = 1; i <= chapterCount; i++) {
                const chapterButton = document.createElement('button');
                chapterButton.className = 'chapter-button';
                chapterButton.textContent = i;
                chapterButton.addEventListener('click', function() {
                    selectChapter(i);
                });
                chaptersGrid.appendChild(chapterButton);
            }
        }

        // 選擇章節 - 直接載入整章內容
        function selectChapter(chapter) {
            currentChapter = chapter;
            
            // 更新章節按鈕狀態
            document.querySelectorAll('.chapter-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 直接載入章節內容
            loadChapter(currentBook, chapter);
        }

        // 載入章節內容
        async function loadChapter(book, chapter) {
            const bibleContent = document.getElementById('bibleContent');
            const version = document.getElementById('bibleVersion').value;
            
            // 顯示載入中
            bibleContent.style.display = 'block';
            bibleContent.innerHTML = '<div class="loading">載入中...</div>';
            
            try {
                // 從本地文本檔案載入
                const response = await fetch(`/data/bible-versions/${version.toLowerCase()}-bible.txt`);
                if (!response.ok) {
                    throw new Error('無法載入聖經檔案');
                }
                
                const text = await response.text();
                const verses = parseBibleText(text, book, chapter);
                
                if (verses.length === 0) {
                    bibleContent.innerHTML = '<div class="error">找不到該章節的內容</div>';
                    return;
                }
                
                // 渲染章節內容
                renderChapterContent(book, chapter, verses, version);
                
            } catch (error) {
                console.error('載入章節失敗:', error);
                bibleContent.innerHTML = '<div class="error">載入章節失敗</div>';
            }
        }

        // 解析聖經文本
        function parseBibleText(text, book, chapter) {
            const verses = [];
            const lines = text.split('\n');
            let inTargetBook = false;
            let inTargetChapter = false;
            
            for (let line of lines) {
                line = line.trim();
                
                // 檢查是否進入目標書卷
                if (line.startsWith('# ') && line.includes(book.zh)) {
                    inTargetBook = true;
                    inTargetChapter = false;
                    continue;
                }
                
                // 如果遇到其他書卷，停止搜索
                if (inTargetBook && line.startsWith('# ') && !line.includes(book.zh)) {
                    break;
                }
                
                // 檢查是否進入目標章節
                if (inTargetBook && line.includes(`===`) && line.includes(`第${chapter}章`)) {
                    inTargetChapter = true;
                    continue;
                }
                
                // 如果遇到下一章，停止搜索
                if (inTargetChapter && line.includes('===') && line.includes('第') && line.includes('章') && !line.includes(`第${chapter}章`)) {
                    break;
                }
                
                // 解析經文
                if (inTargetChapter && line.match(/^\d+\./)) {
                    const match = line.match(/^(\d+)\.\s*(.+)$/);
                    if (match) {
                        verses.push({
                            verse: parseInt(match[1]),
                            text: match[2].trim()
                        });
                    }
                }
            }
            
            return verses.sort((a, b) => a.verse - b.verse);
        }

        // 渲染章節內容
        function renderChapterContent(book, chapter, verses, version) {
            const bibleContent = document.getElementById('bibleContent');
            
            const html = `
                <div class="bible-header">
                    <div class="bible-title">${book.zh} 第${chapter}章</div>
                    <div class="bible-version">版本：${version}</div>
                </div>
                <div class="bible-text">
                    ${verses.map(verse => `
                        <div class="verse">
                            <span class="verse-number">${verse.verse}.</span>
                            <span class="verse-text">${verse.text}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            bibleContent.innerHTML = html;
        }

        // 隱藏的經文解釋功能 - 保留程式碼供未來使用
        /*
        function explainVerse(book, chapter, verse) {
            // 經文解釋功能的程式碼
            // 目前隱藏，保留供未來使用
            console.log(`解釋 ${book.zh} ${chapter}:${verse}`);
        }
        
        function showExplanation(explanation) {
            // 顯示解釋內容的程式碼
            // 目前隱藏，保留供未來使用
            console.log('顯示解釋:', explanation);
        }
        */
    </script>
</body>
</html> 